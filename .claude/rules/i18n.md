# Internationalization (i18n) Rules

## Languages
- **PT-BR** (default) and **EN** only — no other languages planned
- PT-BR is the fallback for any missing EN translation
- User selects language in their profile settings; stored in `User.locale`

## Frontend — next-intl

### File Structure
```
frontend/
  messages/
    pt-BR.json    # complete — source of truth
    en.json       # complete — must mirror all keys from pt-BR.json
```

### Key Naming
- Flat namespace per page/feature: `{feature}.{element}.{descriptor}`
- Examples:
  - `dashboard.title` → "Painel"
  - `shareholders.table.empty` → "Nenhum acionista encontrado"
  - `errors.cap.insufficientShares` → "Ações insuficientes para concluir a transferência"
  - `common.save` → "Salvar"
  - `common.cancel` → "Cancelar"
- Use `common.*` for shared UI strings (buttons, labels, confirmations)
- Use `errors.*` for error messages resolved from backend `messageKey`

### Usage in Components
```tsx
import { useTranslations } from 'next-intl';

export function ShareholderList() {
  const t = useTranslations('shareholders');
  return <h1>{t('table.title')}</h1>;
}
```

### Rules
- Never hardcode user-facing strings — always use translation keys
- Every new user-facing string must be added to both `pt-BR.json` and `en.json`
- Keep keys alphabetically sorted within each namespace
- Do not nest deeper than 3 levels: `namespace.group.key`

## Backend — Message Keys Only

### API Error Responses
- Backend returns a `messageKey` string, NOT a translated message
- Frontend resolves the key using its own translation files
- Error response format:
  ```json
  {
    "success": false,
    "error": {
      "code": "CAP_INSUFFICIENT_SHARES",
      "messageKey": "errors.cap.insufficientShares",
      "details": { "available": 1000, "requested": 1500 }
    }
  }
  ```
- The `messageKey` maps directly to a key in `messages/pt-BR.json` and `messages/en.json`
- Backend does NOT read `Accept-Language` for API responses

### Email Templates
- Backend selects email template language based on `User.locale`
- Templates stored per locale: `templates/email/{templateName}/pt-BR.mjml`, `templates/email/{templateName}/en.mjml`
- Subject lines stored alongside each template

## Formatting — Always Brazilian

### Numbers
- Always use Brazilian format regardless of language: `1.234,56` (dot = thousands, comma = decimals)
- Use `Intl.NumberFormat('pt-BR', ...)` for all number formatting
- Financial values: always 2 decimal places minimum

### Currency
- Always display as BRL: `R$ 1.234,56`
- Use `Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' })`
- Share prices in USD (when applicable) still use Brazilian number format: `US$ 1.234,56`

### Dates
- Always use Brazilian format: `dd/MM/yyyy` (e.g., `23/02/2026`)
- Use `Intl.DateTimeFormat('pt-BR')` for all date formatting
- Datetime: `dd/MM/yyyy HH:mm` (24-hour clock)

### Percentages
- Brazilian format: `45,5%` (comma as decimal separator)

## Legal Documents
- Templates uploaded in both PT-BR and EN by the user
- Document language selected at generation time
- Both versions are legally separate files, not side-by-side

## Testing
- Verify both locales render correctly for every new component
- Test that missing keys fall back to PT-BR
- Test that formatting helpers always produce Brazilian format regardless of locale
